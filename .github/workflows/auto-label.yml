name: Auto Label Issues

on:
    issues:
        types: [opened, edited]

permissions:
    issues: write

jobs:
    label:
        runs-on: ubuntu-latest
        steps:
            -   name: Add labels based on title/body
                uses: actions/github-script@v6
                with:
                    script: |
                        const title = context.payload.issue.title.toLowerCase();
                        const body = (context.payload.issue.body || "").toLowerCase();
                        const owner = context.repo.owner;
                        const repo = context.repo.repo;
                        const issue_number = context.payload.issue.number;

                        const mapping = [
                            { keywords: ["bug", "error", "exception", "crash"], label: "bug", color: "b60205" },
                            { keywords: ["feat", "feature", "enhancement", "improve"], label: "implementation", color: "0e8a16" },
                            { keywords: ["doc", "documentation", "readme"], label: "documentation", color: "0366d6" },
                            { keywords: ["question", "help"], label: "question", color: "fbca04" }

                        let labelsToAdd = new Set();
                        for (const m of mapping) {
                            for (const kw of m.keywords) {
                                if (title.includes(kw) || body.includes(kw)) {
                                    labelsToAdd.add(m.label);
                                    try {
                                        await github.rest.issues.getLabel({
                                            owner, repo, name: m.label
                                        });
                                    } catch (err) {
                                        await github.rest.issues.createLabel({
                                            owner, repo, name: m.label, color: m.color, description: `Auto-created label ${m.label}`
                                        });
                                    }
                                    break;
                                }
                            }
                        }

                        if (labelsToAdd.size > 0) {
                            await github.rest.issues.addLabels({
                                owner, repo, issue_number, labels: Array.from(labelsToAdd)
                            });
                            core.info(`Added labels: ${Array.from(labelsToAdd).join(", ")}`);
                        } else {
                            core.info("No matching keywords â€” no labels added.");
                        }
                                    